---
layout: post
title: NCP 사용 후기
author: YujinCha
categories: story
tags: CI/CD jenkins NCP
sidebar: []
---
## NCP 사용 계기

지난 11월부터 f-lab멘토링을 시작했다. 이 멘토링 과정에서는 어느 정도 학습진도가 나가면 프로젝트를 진행하게 된다.<br>
프로젝트를 하면서 CI/CD구축도 하고, 성능테스트도 진행하였다.<br>
프로젝트를 위해서 서버가 필요했다.<br>
f-lab에서는 NaverCloudPlatform 크레딧을 제공해주어 NCP로 서버구성을 진행하였다.

## NCP로 CI/CD 구축 

CI/CD 구축하는데, 생각보다 시간이 오래 걸렸다.<br>
풀타임으로 투입하지 못해서 짬을 내어 구성해야 했기때문에 오래걸리기도 했고, 맨땅에 헤딩도 많이 해서 서버와 젠킨스 설정도 몇번 갈아엎었다.<br>
최종적인 CI/CD 구성도는 아래와 같다.
![CICD구성도](https://user-images.githubusercontent.com/19955465/230276236-7af529e0-b771-4688-9b80-cf959c9c1412.png)
NCP서버로 총 3대의 서버를 만들어 구성하였다.<br>
1. CI/CD서버 (Jenkins서버)<br>
2. 배포서버<br>
3. DB서버<br>

처음에는 젠킨스 설정도 다 해보겠다고 젠킨스 서버까지 만들어 3대의 서버를 만들어 구성했었다.<br>
그러다 같은팀의 멘티분과 함께 서버를 구성하였고, 최종적으로 팀 멘티분은 젠킨스서버를 나는 배포서버와 DB서버를 세팅하여 서버를 구성하게 되었다.<br>
현재 이렇게 구성한지 1달반 정도 되었는데 크레딧이 10만원을 넘어섰다.<br>
2주정도 서버를 3대로 구성하여 사용했었고 1달정도 서버 2대로 서비스를 이용했다.<br>

#### 전체 구축 과정
1. ACG를 생성한다.
2. 서버 스펙과 이미지, ACG를 선택하여 서버를 만든다.
   * 스펙 : 사용 목적에 맞추어 서버 스펙을 결정해야 한다.
   * 이미지 : 편하게 OS나 프로그램을 설치해준다. 
   * ACG : 방화벽이라고 보면 된다. 터미널 접근에 대한 권한을 컨트롤을 하는 기능이다. (참고로,서버만들 때 선택하는 ACG를 나중에 바꿀 수가 없으니, 미리 만들어놓은 ACG를 선택하여 사용하는 것이 좋다.)
3. 서버접속용 정보로 터미널에 접속하여 필요한 프로그램을 설치한다.


#### 서버 스펙 결정과 생성
먼저, 서버를 생성하려면 어느 수준의 서버 스펙이 필요한지 알아봐야 한다.<br>
설치할 프로그램에 대한 공식문서에서 최소사양이나 권장사양을 가이드하는 게 있는지 찾아보면 좋다.<br>
젠킨스의 최소사양은 아래와 링크에서 확인이 가능하다.<br>
젠킨스의 최소사양은 256MB의 메모리와 1GB의 드라이브 공간을 필요로 한다.<br>
(젠킨스 공식문서 : https://www.jenkins.io/doc/book/installing/linux/)

그럼 이에 맞춰서 NCP에서 만들 수 있는 서버 사양도 확인해봐야 한다.<br>
  * 서버 스펙 : https://guide.ncloud-docs.com/docs/server-spec
  * 서버별 특징 : https://www.ncloud.com/product/compute/server

서버 생성시에 서버 사양을 선택할 수 있는데, 최소사양보다 하나 높은 사양인 Compact로 생성하였다.<br>
젠킨스 최소사양을 봤을 때, 최소사양인 Micro을 만들어도 되는데 이미지에 버그가 있어서 그 다음 사양인 Compact를 선택하였다.<br>
Micro사양으로 Application 젠킨스 이미지를 설치하면 깡통서버가 설치되는 버그가 있었다. OS만 설치된 깡통서버에 직접 젠킨스 설치하여 진행할 수 있었지만, 시간이 별로 없어서 젠킨스 이미지가 정상적으로  Compact사양으로 올린 것이다.<br>
비용적으로 더 Micro타입이 저렴하기때문에 서버 사양을 Micro타입으로 해도 될 것 같다.

