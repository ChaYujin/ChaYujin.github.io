---
layout: post
title: JVM스레드는 운영체제에서 어떻게 처리할까?
#subheading: 부재
author: YujinCha
categories: example
tags: 예제 마크다운
sidebar: []
---

자바의 신 책을 읽으며 스레드에 대한 이해가 아직 부족하다고 생각이 들었다.
프로세스와 스레드의 차이에 대해서, 그리고 멀티 프로세스와 멀티 스레드 시스템의 장단점에 대해서 설명을 하려니 지식의 구멍이 있는 것을 깨달았다.
그래서 운영체제의 프로세스부터 다시 찾아서 보았고, 내가 이해한 나의 언어로 다시 정리한 내용이다.
그러므로 아주 주간적이고 간략하게 내용을 정리한다.

## 프로세스와 스레드
스레드를 이야기하려면 어느 블로그든 프로세스를 먼저 이야기할 것이다.

빠르고 간단하게 살펴보면, 프로세스는 운영체제로부터 Virtual Memory Space를 할당받는 주체이고 PCB(Process Control Block, 프로레스 정보를 담는 자료구조)를 만들어 운영체제의 스케줄링의 대상이 된다.

스레드는 실행단위, 흐름이라고 하고 경량프로세스(LWP)라고 칭하는 운영체제도 있다. 스레드는 프로세스와 밀접한 관계를 갇는데, 스레드는 프로세스가 할당받은 메모리 공간을 사용하고, 프로세스에는 최소 1개의 스레드가 구성이 된다.

스레드도 PCB와 비슷한 TCB(Thread Control Block)를 만들어 스레드를 스케줄링한다. 

이 스케줄링을 하는 주체는 운영체제이다.


## 운영체제의 스케줄링
프로세스도 스케줄링의 대상이 되고 스레드도 스케줄링의 대상이 된다. 이 부분이 너무 애매하다.

어떤 책에서는 프로세스는 스레드를 담는 그릇일 뿐, 운영체제에서는 실제 흐름인 스레드만 신경쓰면 된다. 라고 설명한다.

그런데, CPU의 스케줄링 기법에 대한 설명은 프로세스 기준, 즉 PCB로만 설명하는 것을 흔히 볼 수 있다. 대부분 PCB로 설명한다.

그러면 프로세스 단위로만 CPU에 할당되어 동작하는 것 일까?
이 말은 CPU가 멀티코어여도 멀티스레드 프로세스가 1개만 있을 경우 1개의 코어에만 할당된다는 이야기일까?
멀티스레드 프로세스는 멀티코어 환경에서 동시성으로만 처리되는 것인가 병렬로 처리되는 것일까?
 * 동시성은 여러의 흐름(여러 기능)을 매우 빠르게 번갈아가며 처리하여 마치 동시에 진행되는 것처럼 느끼게 하는 것이다. (여러개의 일을 1명이 처리하는 것)
 * 병렬성은 실제 여러 흐름의 명령어가 동시에 처리되는 것이다. (여러개의 일을 여러명이 동시에 병렬적으로 처리하는 것)
 
이에 대한 답을 찾는 것이 생각보다 쉽지 않았다. 

결론적으로 말하면, 프로세스에서 스레드 생성에 사용한 커널 함수에 따라 다르다.

아래 운영체제 강의를 보고 답을 찾는데 도움을 많이 받았다.
https://youtu.be/knAXJH2ewNM

## JVM의 스레드
그럼 JVM에서는 어떻게 쓰레드를 만들고 있을까?

예전에는 JVM에서 GreenThread를 사용하여 스레드를 구현했다고 한다. 이 GreenThread는 멀티코어 환경에서 여러개의 코어를 사용하지 않고 1개의 코어만 사용하여 처리한다. 즉, 병렬적으로 처리되지않고 동시성으로만 처리된다.

GreenThread에 대한 설명은 위키페이지를 참고하면 좋을 것 같다.

https://en.wikipedia.org/wiki/Green_thread


지금은 각 운영체제의 쓰레드를 생성하는 함수를 사용한다. 아래 링크에서 jvm Thread 코드에서 무엇을 호출하는지 분석하고 있다.

https://medium.com/@unmeshvjoshi/how-java-thread-maps-to-os-thread-e280a9fb2e06

위의 링크의 내용을 보면, 리눅스 환경에서는 pthread를 생성한다. 이 pthread는 병렬처리를 지원하는 스레드이다.

아마 JVM에서 윈도우즈 스레드를 만드는 코드에서도 병렬성을 지원하는 코드로 실행할 것이다.

